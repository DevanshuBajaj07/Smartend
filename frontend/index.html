<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Smart Cloud Drive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Main stylesheet -->
    <link rel="stylesheet" href="style.css" />
</head>

<body class="theme-light">
    <!-- Soft cloudy gradient background -->
    <div class="app-background"></div>

    <!-- Main app container -->
    <div class="app-shell">
        <!-- HEADER / TOP BAR -->
        <header class="app-header">
            <div class="app-title">
                <div class="app-logo-circle">
                    <span>SC</span>
                </div>
                <div>
                    <h1>Smart Cloud Drive</h1>
                    <p>Cloud-based file hub for all your documents.</p>
                </div>
            </div>

            <div class="header-right">
                <!-- Theme toggle (NEW) -->
                <button id="themeToggleBtn" class="theme-toggle-btn" type="button" aria-label="Toggle theme"
                    data-theme="light">
                    <span class="icon-sun">‚òÄÔ∏è</span>
                    <span class="icon-moon">üåô</span>
                </button>

                <!-- Status badge (updated by script.js) -->
                <div class="status-wrapper">
                    <span id="statusBadge" class="status-badge">Checking...</span>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="app-main">
            <div class="layout-grid">
                <!-- LEFT: Upload + Browser -->
                <div class="primary-column">
                    <!-- UPLOAD CARD -->
                    <section class="upload-section card">
                        <div class="card-header">
                            <div>
                                <h2>Upload Files</h2>
                                <p>Drop your files here and Smart Cloud Drive will organize them.</p>
                            </div>
                        </div>

                        <div id="dropZone" class="drop-zone">
                            <div class="drop-zone-inner">
                                <div class="upload-icon">‚òÅÔ∏è</div>
                                <h3>Drag &amp; Drop to Upload</h3>
                                <p>or pick files from your device</p>
                                <button id="browseBtn" class="btn btn-primary">Browse Files</button>
                                <!-- Hidden input used by JS -->
                                <input id="fileInput" type="file" multiple style="display: none" />
                            </div>
                        </div>

                        <!-- üîÑ Upload spinner overlay (shown while talking to backend) -->
                        <div id="uploadSpinner" class="upload-spinner hidden" aria-live="polite">
                            <div class="upload-spinner-ring"></div>
                            <span class="upload-spinner-text">Uploading...</span>
                        </div>

                        <!-- üìä Upload progress bar (0‚Äì100%) -->
                        <div id="uploadProgress" class="upload-progress hidden" aria-hidden="true">
                            <div class="upload-progress-track">
                                <div id="uploadProgressBar" class="upload-progress-bar"></div>
                            </div>
                            <span id="uploadProgressText" class="upload-progress-text">0%</span>
                        </div>
                    </section>

                    <!-- FILE BROWSER CARD -->
                    <section class="browser-section card">
                        <div class="card-header">
                            <div class="breadcrumb-block">
                                <button id="backToFoldersBtn" class="btn btn-ghost" disabled>
                                    ‚Üê Folders
                                </button>
                                <span id="currentFolderLabel" class="breadcrumb-label">
                                    Folders
                                </span>
                            </div>
                            <div class="search-sort-block">
                                <div class="input-wrapper">
                                    <span class="input-icon">üîç</span>
                                    <input id="searchInput" type="text" placeholder="Search by file or folder name..."
                                        class="search-input" />
                                </div>
                                <select id="sortSelect" class="sort-select">
                                    <option value="name-asc">Name (A ‚Üí Z)</option>
                                    <option value="name-desc">Name (Z ‚Üí A)</option>
                                    <option value="size-asc">Size (Small ‚Üí Large)</option>
                                    <option value="size-desc">Size (Large ‚Üí Small)</option>
                                    <option value="created-new">Created (New ‚Üí Old)</option>
                                    <option value="created-old">Created (Old ‚Üí New)</option>
                                    <option value="access-new">Last Access (New ‚Üí Old)</option>
                                    <option value="access-old">Last Access (Old ‚Üí New)</option>
                                </select>
                            </div>
                        </div>

                        <div class="browser-body">
                            <!-- Folder grid view (default) -->
                            <div id="folderView">
                                <div id="folderGrid" class="folder-grid">
                                    <!-- Filled by JS -->
                                </div>
                            </div>

                            <!-- File table view (inside a folder) -->
                            <div id="fileView" class="hidden">
                                <!-- Matching folders for search results (appears above file table) -->
                                <div id="searchFolderMatches" class="folder-grid search-folder-grid"></div>
                                <div class="table-wrapper">
                                    <table id="fileTable" class="file-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th>Extension</th>
                                                <th>Size</th>
                                                <th>Created</th>
                                                <th>Last Access</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="fileTableBody">
                                            <!-- Filled by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- RIGHT: Rules sidebar -->
                <aside class="side-column">
                    <section class="rules-section card">
                        <div class="card-header">
                            <div>
                                <h2>Custom Folder Rules</h2>
                                <p>Teach Smart Cloud Drive how to auto-sort new file types.</p>
                            </div>
                        </div>

                        <div class="rules-form">
                            <div class="field-group">
                                <label for="ruleFolder">Folder name</label>
                                <input id="ruleFolder" type="text" placeholder="e.g. CAD" />
                            </div>
                            <div class="field-group">
                                <label for="ruleExtensions">Extensions</label>
                                <input id="ruleExtensions" type="text" placeholder="e.g. dwg, dxf" />
                            </div>
                            <button id="saveRuleBtn" class="btn btn-primary btn-full">
                                Save Rule
                            </button>
                        </div>

                        <div class="rules-list-header">
                            <span>Active Rules</span>
                        </div>
                        <div id="rulesList" class="rules-list">
                            <!-- Filled by JS -->
                        </div>

                        <p class="rules-hint">
                            Example: folder <code>CAD</code> with
                            <code>dwg, dxf</code> will automatically capture new CAD files.
                        </p>
                    </section>
                </aside>
            </div>
        </main>
    </div>

    <!-- Preview modal -->
    <div id="previewModal" class="modal hidden">
        <div class="modal-backdrop" id="previewBackdrop"></div>
        <div class="modal-content" role="dialog" aria-modal="true">
            <button id="previewCloseBtn" class="modal-close" aria-label="Close preview">√ó</button>
            <div id="previewBody" class="preview-body"></div>
        </div>
    </div>

    <!-- üîî Toast notifications container -->
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Markdown renderer + sanitizer (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>

    <!-- Main app logic -->
    <script src="script.js"></script>

    <!-- Small extra script ONLY for theme toggle -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const btn = document.getElementById("themeToggleBtn");
            if (!btn) return;

            // Determine initial theme (localStorage > system preference > light)
            const stored = localStorage.getItem("scd-theme");
            const prefersDark =
                window.matchMedia &&
                window.matchMedia("(prefers-color-scheme: dark)").matches;

            let current = stored || (prefersDark ? "dark" : "light");

            function applyTheme(mode) {
                document.body.classList.remove("theme-light", "theme-dark");
                document.body.classList.add("theme-" + mode);
                btn.dataset.theme = mode;
                btn.setAttribute(
                    "aria-label",
                    mode === "light"
                        ? "Switch to dark theme"
                        : "Switch to light theme"
                );
            }

            applyTheme(current);

            btn.addEventListener("click", function () {
                current = current === "light" ? "dark" : "light";
                applyTheme(current);
                localStorage.setItem("scd-theme", current);
            });
        });
    </script>
</body>

</html>